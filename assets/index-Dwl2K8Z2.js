(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}})();class d{constructor(...e){this.shape=e}toHTML(){const e=document.createElement("table");e.classList.add("block");const s=document.createElement("tbody");e.appendChild(s);for(const t of this.shape){const o=document.createElement("tr");s.appendChild(o);for(const r of t){const i=document.createElement("td");i.classList.toggle("empty",!r),i.classList.add("filled"),o.appendChild(i)}}return e}}class f{constructor(){this.table=document.createElement("table"),this.columns=[[],[],[],[],[],[],[],[],[]],this.squares=[[],[],[],[],[],[],[],[],[]],this.rows=[[],[],[],[],[],[],[],[],[]],this.table.className="main";for(let e=0;e<9;e++){const s=document.createElement("tr");for(let t=0;t<9;t++){const o=document.createElement("td");s.appendChild(o),this.rows[e].push(o),this.columns[t].push(o);const r=Math.floor(e/3)*3+Math.floor(t/3);r%2?o.classList.add("light"):o.classList.add("dark"),this.squares[r].push(o)}this.table.appendChild(s)}}getFieldFor(e){const s=e.getBoundingClientRect();for(let t=0;t<this.table.rows.length;t++)for(let o=0;o<this.table.rows[t].cells.length;o++){const r=this.table.rows[t].cells[o].getBoundingClientRect(),i=20;if(Math.abs(r.left-s.left)<i&&Math.abs(r.top-s.top)<i)return[o,t]}return null}canPlace(e,s,t){var o;for(let r=0;r<t.rows.length;r++)for(let i=0;i<t.rows[r].cells.length;i++){if(t.rows[r].cells[i].classList.contains("empty"))continue;const n=(o=this.table.rows[s+r])==null?void 0:o.cells[e+i];if(!n||n.classList.contains("filled")&&!n.classList.contains("animation"))return!1}return!0}mark(e,s,t,o){const r=[];for(let i=0;i<t.rows.length;i++)for(let n=0;n<t.rows[i].cells.length;n++)t.rows[i].cells[n].classList.contains("empty")||(this.table.rows[s+i].cells[e+n].classList.add(o),r.push(this.table.rows[s+i].cells[e+n]));return r}isDisabled(e){for(let s=0;s<9;s++)for(let t=0;t<9;t++)if(this.canPlace(t,s,e))return!1;return!0}clearHighlights(){for(const e of this.table.querySelectorAll("td.highlight,td.match"))e.classList.remove("highlight"),e.classList.remove("match")}clearFilled(){var n;const e=(n=this.table.closest(".app"))==null?void 0:n.style,s=e.getPropertyValue("--animation")||"none",t=+e.getPropertyValue("--gradual")||0;let o=0;const r=this.getCompleting(),i=r.length;i>1&&this.showCombo(i);for(const a of r){for(let c=0;c<a.length;c++){const h=a[c];if(h.classList.add("animation"),s!=="none"){const l=t?c/a.length*1e3:0;window.setTimeout(()=>{h.classList.remove("filled"),h.classList.remove("animation"),h.classList.add(s),window.setTimeout(()=>{h.classList.remove(s)},1e3)},l)}else h.classList.remove("filled")}o+=a.length}return o*i}showCombo(e){const s=this.table.closest(".app"),t=document.createElement("div");t.classList.add("combo-popup"),t.textContent=`Combo X${e}!`,s.appendChild(t),setTimeout(()=>{t.remove()},1e3)}getCompleting(e=[]){const s=t=>t.every(o=>o.classList.contains("filled")&&!o.classList.contains("animation")||e.includes(o));return[...this.columns.filter(s),...this.rows.filter(s),...this.squares.filter(s,0)]}positionFor(e){const s=e.getBoundingClientRect();for(let t=0;t<this.table.rows.length;t++)for(let o=0;o<this.table.rows[t].cells.length;o++){const r=this.table.rows[t].cells[o].getBoundingClientRect(),i=r.width*.75;if(Math.abs(r.left-s.left)<i&&Math.abs(r.top-s.top)<i)return[o,t]}return null}}class y{constructor(){this.settings=document.createElement("dialog"),this.gameOver=document.createElement("dialog"),this.panel=document.createElement("div"),this.app=document.createElement("div"),this.settingsButton=document.createElement("button"),this.board=new f,this.blocks=[new d([!0]),new d([!0,!0]),new d([!0,!0,!0]),new d([!0],[!0]),new d([!0],[!0],[!0]),new d([!0,!0],[!0,!0]),new d([!1,!0,!0],[!0,!0]),new d([!0,!0],[!0]),new d([!0],[!0,!0]),new d([!0,!0,!0],[!1,!1,!0],[!1,!1,!0]),new d([!1,!0],[!0,!0,!0]),new d([!1,!0],[!0]),new d([!0],[!0],[!0,!0]),new d([!1,!1,!0],[!1,!0],[!0]),new d([!0],[!1,!0],[!1,!1,!0])],this._highScore=0;const e=document.createElement("div");e.className="panel",e.append(this.panel),this.app.classList.add("app"),this.panel.addEventListener("touchstart",this,{passive:!1}),this.panel.addEventListener("mousedown",this),this.app.append(this.board.table,e,this.settingsButton),this.fill(),this.createSettingsDialog(),this.gameOver.innerHTML=`
            <h1>Game Over</h1>
            <form method="dialog" class="score">
                <div id="highScore"></div>
                <button type="submit">Reset</button>
            </form>
        `,this.gameOver.onclose=()=>this.reset(),this.settingsButton.textContent="Settings",this.settingsButton.addEventListener("click",()=>this.settings.showModal()),this.app.append(this.gameOver),this.createHighScoreDisplay(),this.loadHighScore(),this.createFooter()}createHighScoreDisplay(){const e=document.createElement("div");e.classList.add("high-score"),this.app.appendChild(e)}createFooter(){const e=document.createElement("footer");e.innerHTML=`
            <p>
                A fork of <a href="https://github.com/tomaswrobel/blocksdoku">BlocksDoku</a>,
                which is inspired by Blockudoku.
            </p>
        `,this.app.appendChild(e)}createSettingsDialog(){this.settings.innerHTML=`
            <h1>Settings</h1>
            <form method="dialog">
                <div class="setting">
                    <label>Theme</label>
                    <label class="color" for="theme" style="background-color:#3030ff"></label>
                    <input type="color" value="#3030ff" id="theme"/>
                </div>
                <div class="setting">
                    <label>Animation</label>
                    <select id="animation">
                        <option value="none">None</option>
                        <option value="fade-out">Fade out</option>
                        <option value="explode">Explode</option>
                        <option value="ripple">Ripple</option>
                        <option value="spin" selected>Spin</option>
                        <option value="swirl">Swirl</option>
                        <option value="colorswirl">Color Swirl</option>
                    </select>
                </div>
                 <div class="setting">
                    <label>Gradual Animation</label>
                    <input type="checkbox" id="gradual" />
                </div>
                <button type="submit">OK</button>
                <button type="reset">Reset</button>
            </form>
        `;const e=this.settings.querySelector("#theme"),s=this.settings.querySelector("#animation"),t=this.settings.querySelector("#gradual"),o=localStorage.getItem("settings");if(o){const i=JSON.parse(o);e.value=i.theme,s.value=i.animation,t.checked=i.gradual,this.updateTheme(e.value),this.settings.querySelector("label.color").style.backgroundColor=e.value}this.app.style.setProperty("--animation",s.value),this.app.style.setProperty("--gradual",""+ +t.checked),e.oninput=()=>{this.updateTheme(e.value),this.settings.querySelector("label.color").style.backgroundColor=e.value,this.saveSettings()},s.oninput=()=>{this.app.style.setProperty("--animation",s.value),this.saveSettings()},t.oninput=()=>{this.app.style.setProperty("--gradual",""+ +t.checked),this.saveSettings()};const r=this.settings.querySelector('button[type="reset"]');r.onclick=()=>{localStorage.clear(),window.location.reload()},this.app.append(this.settings)}saveSettings(){const e=this.settings.querySelector("#theme"),s=this.settings.querySelector("#animation"),t=this.settings.querySelector("#gradual");localStorage.setItem("settings",JSON.stringify({theme:e.value,animation:s.value,gradual:t.checked}))}updateTheme(e){this.app.style.setProperty("--color",e)}set score(e){this.app.style.setProperty("--score",`${e}`),e>this.highScore&&(this.highScore=e,this.saveHighScore())}get score(){return+this.app.style.getPropertyValue("--score")}set highScore(e){this.gameOver.querySelector("#highScore").textContent=`High Score: ${e}`,this._highScore=e,this.app.querySelector(".high-score").textContent=`High Score: ${e}`}get highScore(){return this._highScore}loadHighScore(){const e=localStorage.getItem("highScore");if(e){if(e==="matan-h"){const s=document.createElement("h1");s.textContent="No way... thats the coolest name ever, in your high score...",s.style.cssText=`
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 5em;
                    color: blue;
                    font-weight: bold;
                    background-color: rgba(255, 255, 255, 0.9);
                    z-index: 1000;
                    text-align:center;
                    --e-aster-egg: true;
                `,this.app.prepend(s),setTimeout(()=>{s.remove()},5e3)}this.highScore=this.decodeHighScore(e)}this.app.querySelector(".high-score").textContent=`High Score: ${this.highScore}`}saveHighScore(){localStorage.setItem("highScore",this.encodeHighScore(this.highScore))}encodeHighScore(e){let s="";for(;e>0;){const t=Math.min(e,65535);s+=String.fromCharCode(t),e-=t}return s}decodeHighScore(e){let s=0;for(let t=0;t<e.length;t++)s+=e.charCodeAt(t);return s}fill(){const e=this.blocks.slice();e.sort(()=>Math.random()-.5),e.splice(3);for(const s of e)this.panel.appendChild(s.toHTML());this.check()}handleEvent(e){e.preventDefault();const s=e.target,t=s.closest("table");if(s.tagName!=="TD")return;const o=n=>{if(n&&this.board.canPlace(...n,t)){let a=this.board.mark(...n,t,"highlight");this.board.getCompleting(a).forEach(c=>c.forEach(h=>h.classList.add("match")))}};let r,i;if(e instanceof MouseEvent){if(e.button!==0)return;r=n=>{n.preventDefault();const a=+t.style.getPropertyValue("--dx"),c=+t.style.getPropertyValue("--dy"),h=this.board.getFieldFor(t);t.style.setProperty("--dx",`${a+n.movementX}`),t.style.setProperty("--dy",`${c+n.movementY}`),this.board.clearHighlights(),o(h)},i=n=>{n.preventDefault(),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",i);const a=this.board.getFieldFor(t);t.style.removeProperty("--dx"),t.style.removeProperty("--dy"),a&&this.board.canPlace(...a,t)&&(this.score+=t.querySelectorAll("td:not(.empty)").length,this.board.mark(...a,t,"filled"),t.classList.add("used"),this.score+=this.board.clearFilled(),this.check()),this.board.clearHighlights();for(const c of this.panel.children)if(!c.classList.contains("used"))return;this.panel.innerHTML="",this.fill()},document.addEventListener("mousemove",r),document.addEventListener("mouseup",i)}else e instanceof TouchEvent&&(r=n=>{n.preventDefault();const a=+t.style.getPropertyValue("--dx"),c=+t.style.getPropertyValue("--dy"),h=n.changedTouches[0],l=h.target,p=this.board.getFieldFor(t);t.style.setProperty("--dx",`${a+h.clientX-(l.getBoundingClientRect().left+t.offsetWidth/2)}`),t.style.setProperty("--dy",`${c+h.clientY-(l.getBoundingClientRect().top+t.offsetHeight/2)}`),this.board.clearHighlights(),o(p)},i=()=>{document.removeEventListener("touchmove",r),document.removeEventListener("touchend",i);const n=this.board.getFieldFor(t);t.style.removeProperty("--dx"),t.style.removeProperty("--dy"),n&&this.board.canPlace(...n,t)&&(this.score+=t.querySelectorAll("td:not(.empty)").length,this.board.mark(...n,t,"filled"),t.classList.add("used"),this.score+=this.board.clearFilled(),this.check()),this.board.clearHighlights();for(const a of this.panel.children)if(!a.classList.contains("used"))return;this.panel.innerHTML="",this.fill()},document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("touchend",i))}check(){const e=this.panel.querySelectorAll("table:not(.used)");if(!e.length)return!1;let s=!0;for(const t of e){const o=this.board.isDisabled(t);t.classList.toggle("disabled",o),s=s&&o}s&&setTimeout(()=>this.gameOver.showModal(),1e3)}reset(){this.score=0;for(const e of this.board.table.querySelectorAll("td.filled"))e.classList.remove("filled");this.panel.innerHTML="",this.fill()}}const b="modulepreload",v=function(u){return"/"+u},m={},w=function(e,s,t){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),n=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(s.map(a=>{if(a=v(a),a in m)return;m[a]=!0;const c=a.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${h}`))return;const l=document.createElement("link");if(l.rel=c?"stylesheet":b,c||(l.as="script"),l.crossOrigin="",l.href=a,n&&l.setAttribute("nonce",n),document.head.appendChild(l),c)return new Promise((p,g)=>{l.addEventListener("load",p),l.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${a}`)))})}))}function r(i){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=i,window.dispatchEvent(n),!n.defaultPrevented)throw i}return o.then(i=>{for(const n of i||[])n.status==="rejected"&&r(n.reason);return e().catch(r)})};function S(u={}){const{immediate:e=!1,onNeedRefresh:s,onOfflineReady:t,onRegistered:o,onRegisteredSW:r,onRegisterError:i}=u;let n,a;const c=async(l=!0)=>{await a};async function h(){if("serviceWorker"in navigator){if(n=await w(async()=>{const{Workbox:l}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:l}},[]).then(({Workbox:l})=>new l("/sw.js",{scope:"/",type:"classic"})).catch(l=>{i==null||i(l)}),!n)return;n.addEventListener("activated",l=>{(l.isUpdate||l.isExternal)&&window.location.reload()}),n.addEventListener("installed",l=>{l.isUpdate||t==null||t()}),n.register({immediate:e}).then(l=>{r?r("/sw.js",l):o==null||o(l)}).catch(l=>{i==null||i(l)})}}return a=h(),c}const L=new y;document.body.append(L.app);S({immediate:!0});
