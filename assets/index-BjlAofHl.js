(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();class d{constructor(...e){this.shape=e}toHTML(){const e=document.createElement("table");e.classList.add("block");const s=document.createElement("tbody");e.appendChild(s);for(const t of this.shape){const r=document.createElement("tr");s.appendChild(r);for(const n of t){const o=document.createElement("td");o.className="selectShape",o.classList.toggle("empty",!n),o.classList.add("filled"),r.appendChild(o)}}return e}}class y{constructor(){this.table=document.createElement("table"),this.subTables=[],this.columns=[[],[],[],[],[],[],[],[],[]],this.rows=[[],[],[],[],[],[],[],[],[]],this.squares=[[],[],[],[],[],[],[],[],[]],this.table.className="main";for(let e=0;e<3;e++){const s=document.createElement("tr");for(let t=0;t<3;t++){const r=document.createElement("table");r.classList.add("subgrid"),this.subTables.push(r);const n=document.createElement("tbody");r.appendChild(n);for(let o=0;o<3;o++){const i=document.createElement("tr");for(let l=0;l<3;l++){const a=document.createElement("td");a.className="boardShape",i.appendChild(a);const h=e*3+o,c=t*3+l;this.rows[h].push(a),this.columns[c].push(a);const g=e*3+t;(g+1)%2&&r.classList.add("dark"),this.squares[g].push(a)}n.appendChild(i)}s.appendChild(r)}this.table.appendChild(s)}}getFieldFor(e){const s=e.getBoundingClientRect();for(let t=0;t<this.subTables.length;t++){const r=this.subTables[t];for(let n=0;n<r.rows.length;n++)for(let o=0;o<r.rows[n].cells.length;o++){const i=r.rows[n].cells[o].getBoundingClientRect(),l=20;if(Math.abs(i.left-s.left)<l&&Math.abs(i.top-s.top)<l)return[o+t%3*3,n+Math.floor(t/3)*3]}}return null}canPlace(e,s,t){var r;for(let n=0;n<t.rows.length;n++)for(let o=0;o<t.rows[n].cells.length;o++){if(t.rows[n].cells[o].classList.contains("empty"))continue;const i=(r=this.rows[s+n])==null?void 0:r[e+o];if(!i||i.classList.contains("filled")&&!i.classList.contains("animation"))return!1}return!0}mark(e,s,t,r){const n=[];for(let o=0;o<t.rows.length;o++)for(let i=0;i<t.rows[o].cells.length;i++)t.rows[o].cells[i].classList.contains("empty")||(this.rows[s+o][e+i].classList.add(r),n.push(this.rows[s+o][e+i]));return n}isDisabled(e){for(let s=0;s<9;s++)for(let t=0;t<9;t++)if(this.canPlace(t,s,e))return!1;return!0}clearHighlights(){for(const e of this.table.querySelectorAll("td.highlight,td.match"))e.classList.remove("highlight"),e.classList.remove("match")}clearFilled(){var i;const e=(i=this.table.closest(".app"))==null?void 0:i.style,s=e.getPropertyValue("--animation")||"none",t=+e.getPropertyValue("--gradual")||0;let r=0;const n=this.getCompleting(),o=n.length;o>1&&this.showCombo(o);for(const l of n){for(let a=0;a<l.length;a++){const h=l[a];if(h.classList.add("animation"),s!=="none"){const c=t?a/l.length*1e3:0;window.setTimeout(()=>{h.classList.remove("filled"),h.classList.remove("animation"),h.classList.add(s),window.setTimeout(()=>{h.classList.remove(s)},1e3)},c)}else h.classList.remove("filled")}r+=l.length}return r*o}showCombo(e){const s=this.table.closest(".app"),t=document.createElement("div");t.classList.add("combo-popup"),t.textContent=`Combo X${e}!`,s.appendChild(t),setTimeout(()=>{t.remove()},1e3)}getCompleting(e=[]){const s=t=>t.every(r=>r.classList.contains("filled")&&!r.classList.contains("animation")||e.includes(r));return[...this.columns.filter(s),...this.rows.filter(s),...this.squares.filter(s,0)]}positionFor(e){const s=e.getBoundingClientRect();for(let t=0;t<this.subTables.length;t++){const r=this.subTables[t];for(let n=0;n<r.rows.length;n++)for(let o=0;o<r.rows[n].cells.length;o++){const i=r.rows[n].cells[o].getBoundingClientRect(),l=i.width*.75;if(Math.abs(i.left-s.left)<l&&Math.abs(i.top-s.top)<l)return[o+t%3*3,n+Math.floor(t/3)*3]}}return null}}class v{constructor(){this.settings=document.createElement("dialog"),this.gameOver=document.createElement("dialog"),this.panel=document.createElement("div"),this.app=document.createElement("div"),this.settingsButton=document.createElement("button"),this.resetButton=document.createElement("button"),this.board=new y,this.settingsButtonSVG=`
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09a1.65 1.65 0 0 0-1-.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09a1.65 1.65 0 0 0 .51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33 1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 .51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82 1.65 1.65 0 0 0 1.51 1h.09a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-.51 1z"></path>
        </svg>
    `,this.resetButtonSVG=`
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rotate-ccw">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
        </svg>
    `,this.blocks=[new d([!0]),new d([!0,!0]),new d([!0,!0,!0]),new d([!0],[!0]),new d([!0],[!0],[!0]),new d([!0,!0],[!0,!0]),new d([!1,!0,!0],[!0,!0]),new d([!0,!0],[!0]),new d([!0],[!0,!0]),new d([!0,!0,!0],[!1,!1,!0],[!1,!1,!0]),new d([!1,!0],[!0,!0,!0]),new d([!1,!0],[!0]),new d([!0],[!0],[!0,!0]),new d([!1,!1,!0],[!1,!0],[!0]),new d([!0],[!1,!0],[!1,!1,!0])],this._highScore=0,this.resetButton.id="resetButton";const e=document.createElement("div");e.className="panel",e.append(this.panel),this.app.classList.add("app"),this.panel.addEventListener("touchstart",this,{passive:!1}),this.panel.addEventListener("mousedown",this),this.app.append(this.board.table,e,this.settingsButton,this.resetButton),this.fill(),this.createSettingsDialog(),this.gameOver.innerHTML=`
            <h1>Game Over</h1>
            <form method="dialog" class="score">
                <div id="highScore"></div>
                <button type="submit">Reset</button>
            </form>
        `,this.gameOver.onclose=()=>this.reset(),this.settingsButton.innerHTML=this.settingsButtonSVG,this.settingsButton.addEventListener("click",()=>this.settings.showModal()),this.resetButton.innerHTML=this.resetButtonSVG,this.resetButton.addEventListener("click",()=>this.reset()),this.app.append(this.gameOver),this.createHighScoreDisplay(),this.loadHighScore(),this.createFooter()}createHighScoreDisplay(){const e=document.createElement("div");e.classList.add("high-score"),this.app.appendChild(e)}createFooter(){const e=document.createElement("footer");e.innerHTML=`
            <p>
                <a href="https://github.com/matan-h/blocksdoku">This game</a> is a fork of <a href="https://github.com/tomaswrobel/blocksdoku">BlocksDoku</a>,
                which is inspired by Blockudoku.
            </p>
        `,this.app.appendChild(e)}createSettingsDialog(){this.settings.innerHTML=`
            <h1>Settings</h1>
            <form method="dialog">
                <div class="setting">
                    <label>Theme</label>
                    <label class="color" for="theme" style="background-color:#2c95af"></label>
                    <input type="color" value="#2c95af" id="theme"/>
                </div>
                <div class="setting">
                    <label>Animation</label>
                    <select id="animation">
                        <option value="none">None</option>
                        <option value="fade-out">Fade out</option>
                        <option value="explode">Explode</option>
                        <option value="ripple">Ripple</option>
                        <option value="spin" selected>Spin</option>
                        <option value="swirl">Swirl</option>
                        <option value="colorswirl">Color Swirl</option>
                    </select>
                </div>
                 <div class="setting">
                    <label>Gradual Animation</label>
                    <input type="checkbox" id="gradual" />
                </div>
                <button type="submit">OK</button>
                <button type="reset">Reset</button>
            </form>
        `;const e=this.settings.querySelector("#theme"),s=this.settings.querySelector("#animation"),t=this.settings.querySelector("#gradual"),r=localStorage.getItem("settings");if(r){const o=JSON.parse(r);e.value=o.theme,s.value=o.animation,t.checked=o.gradual,this.updateTheme(e.value),this.settings.querySelector("label.color").style.backgroundColor=e.value}this.app.style.setProperty("--animation",s.value),this.app.style.setProperty("--gradual",""+ +t.checked),e.oninput=()=>{this.updateTheme(e.value),this.settings.querySelector("label.color").style.backgroundColor=e.value,this.saveSettings()},s.oninput=()=>{this.app.style.setProperty("--animation",s.value),this.saveSettings()},t.oninput=()=>{this.app.style.setProperty("--gradual",""+ +t.checked),this.saveSettings()};const n=this.settings.querySelector('button[type="reset"]');n.onclick=()=>{localStorage.removeItem("settings"),window.location.reload()},this.app.append(this.settings)}saveSettings(){const e=this.settings.querySelector("#theme"),s=this.settings.querySelector("#animation"),t=this.settings.querySelector("#gradual");localStorage.setItem("settings",JSON.stringify({theme:e.value,animation:s.value,gradual:t.checked}))}hexToRgba(e,s){e=e.replace(/^#/,"");let t=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return`rgba(${t}, ${r}, ${n}, ${s})`}updateTheme(e){this.app.style.setProperty("--color",e),this.app.style.setProperty("--subgrid-color",this.hexToRgba(e,.3))}set score(e){this.app.style.setProperty("--score",`${e}`),e>this.highScore&&(this.highScore=e,this.saveHighScore())}get score(){return+this.app.style.getPropertyValue("--score")}set highScore(e){this.gameOver.querySelector("#highScore").textContent=`High Score: ${e}`,this._highScore=e,this.app.querySelector(".high-score").textContent=`High Score: ${e}`}get highScore(){return this._highScore}loadHighScore(){const e=localStorage.getItem("highScore");if(e){if(e==="matan-h"){const s=document.createElement("h1");s.textContent="No way... thats the coolest name ever, in your high score...",s.style.cssText=`
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 5em;
                    color: blue;
                    font-weight: bold;
                    background-color: rgba(255, 255, 255, 0.9);
                    z-index: 1000;
                    text-align:center;
                    --e-aster-egg: true;
                `,this.app.prepend(s),setTimeout(()=>{s.remove()},5e3)}this.highScore=this.decodeHighScore(e)}this.app.querySelector(".high-score").textContent=`High Score: ${this.highScore}`}saveHighScore(){localStorage.setItem("highScore",this.encodeHighScore(this.highScore))}encodeHighScore(e){let s="";for(;e>0;){const t=Math.min(e,65535);s+=String.fromCharCode(t),e-=t}return s}decodeHighScore(e){let s=0;for(let t=0;t<e.length;t++)s+=e.charCodeAt(t);return s}fill(){const e=this.blocks.slice();e.sort(()=>Math.random()-.5),e.splice(3);for(const s of e)this.panel.appendChild(s.toHTML());this.check()}handleEvent(e){e.preventDefault();const s=e.target,t=s.closest("table");if(s.tagName!=="TD")return;const r=i=>{if(i&&this.board.canPlace(...i,t)){let l=this.board.mark(...i,t,"highlight");this.board.getCompleting(l).forEach(a=>a.forEach(h=>h.classList.add("match")))}};let n,o;if(e instanceof MouseEvent){if(e.button!==0)return;n=i=>{i.preventDefault();const l=+t.style.getPropertyValue("--dx"),a=+t.style.getPropertyValue("--dy"),h=this.board.getFieldFor(t);t.style.setProperty("--dx",`${l+i.movementX}`),t.style.setProperty("--dy",`${a+i.movementY}`),this.board.clearHighlights(),r(h)},o=i=>{i.preventDefault(),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o);const l=this.board.getFieldFor(t);t.style.removeProperty("--dx"),t.style.removeProperty("--dy"),l&&this.board.canPlace(...l,t)&&(this.score+=t.querySelectorAll("td:not(.empty)").length,this.board.mark(...l,t,"filled"),t.classList.add("used"),this.score+=this.board.clearFilled(),this.check()),this.board.clearHighlights();for(const a of this.panel.children)if(!a.classList.contains("used"))return;this.panel.innerHTML="",this.fill()},document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}else e instanceof TouchEvent&&(n=i=>{i.preventDefault();const l=+t.style.getPropertyValue("--dx"),a=+t.style.getPropertyValue("--dy"),h=i.changedTouches[0],c=h.target,g=this.board.getFieldFor(t);t.style.setProperty("--dx",`${l+h.clientX-(c.getBoundingClientRect().left+t.offsetWidth/2)}`),t.style.setProperty("--dy",`${a+h.clientY-(c.getBoundingClientRect().top+t.offsetHeight/2)}`),this.board.clearHighlights(),r(g)},o=()=>{document.removeEventListener("touchmove",n),document.removeEventListener("touchend",o);const i=this.board.getFieldFor(t);t.style.removeProperty("--dx"),t.style.removeProperty("--dy"),i&&this.board.canPlace(...i,t)&&(this.score+=t.querySelectorAll("td:not(.empty)").length,this.board.mark(...i,t,"filled"),t.classList.add("used"),this.score+=this.board.clearFilled(),this.check()),this.board.clearHighlights();for(const l of this.panel.children)if(!l.classList.contains("used"))return;this.panel.innerHTML="",this.fill()},document.addEventListener("touchmove",n,{passive:!1}),document.addEventListener("touchend",o))}check(){const e=this.panel.querySelectorAll("table:not(.used)");if(!e.length)return!1;let s=!0;for(const t of e){const r=this.board.isDisabled(t);t.classList.toggle("disabled",r),s=s&&r}s&&setTimeout(()=>this.gameOver.showModal(),1e3)}reset(){this.score=0;for(const e of this.board.table.querySelectorAll("td.filled"))e.classList.remove("filled");this.panel.innerHTML="",this.fill()}}const w="modulepreload",S=function(u,e){return new URL(u,e).href},b={},L=function(e,s,t){let r=Promise.resolve();if(s&&s.length>0){const o=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(s.map(a=>{if(a=S(a,t),a in b)return;b[a]=!0;const h=a.endsWith(".css"),c=h?'[rel="stylesheet"]':"";if(!!t)for(let m=o.length-1;m>=0;m--){const f=o[m];if(f.href===a&&(!h||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${c}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":w,h||(p.as="script"),p.crossOrigin="",p.href=a,l&&p.setAttribute("nonce",l),document.head.appendChild(p),h)return new Promise((m,f)=>{p.addEventListener("load",m),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})}))}function n(o){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=o,window.dispatchEvent(i),!i.defaultPrevented)throw o}return r.then(o=>{for(const i of o||[])i.status==="rejected"&&n(i.reason);return e().catch(n)})};function E(u={}){const{immediate:e=!1,onNeedRefresh:s,onOfflineReady:t,onRegistered:r,onRegisteredSW:n,onRegisterError:o}=u;let i,l;const a=async(c=!0)=>{await l};async function h(){if("serviceWorker"in navigator){if(i=await L(async()=>{const{Workbox:c}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:c}},[],import.meta.url).then(({Workbox:c})=>new c("./sw.js",{scope:"./",type:"classic"})).catch(c=>{o==null||o(c)}),!i)return;i.addEventListener("activated",c=>{(c.isUpdate||c.isExternal)&&window.location.reload()}),i.addEventListener("installed",c=>{c.isUpdate||t==null||t()}),i.register({immediate:e}).then(c=>{n?n("./sw.js",c):r==null||r(c)}).catch(c=>{o==null||o(c)})}}return l=h(),a}const k=new v;document.body.append(k.app);E({immediate:!0});
